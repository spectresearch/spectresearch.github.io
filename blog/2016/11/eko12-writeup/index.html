
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>EKO12 Writeup</title>
    <meta name="description" content="">

    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="shortcut icon" href="/favicon.ico">

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">
    <link rel="stylesheet" type="text/css" href="/assets/css/prism.css?v=31ba63e1d1">
    <link rel="stylesheet" type="text/css" href="/assets/css/screen.css?v=31ba63e1d1">
    <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Merriweather:300,700,700italic,300italic%7COpen+Sans:700,400">

    <link rel="canonical" href="http://www.spect.cl/blog/2016/11/eko12-writeup/">
    <meta name="referrer" content="no-referrer-when-downgrade">
    <link rel="amphtml" href="http://www.spect.cl/blog/2016/11/eko12-writeup/amp/">
    
    <meta property="og:site_name" content="SPECT Research">
    <meta property="og:type" content="article">
    <meta property="og:title" content="EKO12 Writeup">
    <meta property="og:description" content="La semana pasada asistí por primera vez a la ekoparty después de muchos años tratando de ir. Cerca de 2500 asistentes (más menos cinco veces la 8dot8 Chile), un programa de charlas técnicamente interesantes y un buen ambiente con un montón de desafíos por parte de compañías y organizaciones.  El">
    <meta property="og:url" content="http://www.spect.cl/blog/2016/11/eko12-writeup/">
    <meta property="article:published_time" content="2016-11-02T19:13:35.000Z">
    <meta property="article:modified_time" content="2016-11-02T19:14:00.000Z">
    <meta property="article:tag" content="ctf">
    <meta property="article:tag" content="security">
    
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="EKO12 Writeup">
    <meta name="twitter:description" content="La semana pasada asistí por primera vez a la ekoparty después de muchos años tratando de ir. Cerca de 2500 asistentes (más menos cinco veces la 8dot8 Chile), un programa de charlas técnicamente interesantes y un buen ambiente con un montón de desafíos por parte de compañías y organizaciones.  El">
    <meta name="twitter:url" content="http://www.spect.cl/blog/2016/11/eko12-writeup/">
    <meta name="twitter:label1" content="Written by">
    <meta name="twitter:data1" content="Claudio Salazar">
    <meta name="twitter:label2" content="Filed under">
    <meta name="twitter:data2" content="ctf, security">
    <meta name="twitter:site" content="@spectresearch">
    
    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Article",
    "publisher": {
        "@type": "Organization",
        "name": "SPECT Research",
        "logo": "http://www.spect.cl/ghost/img/ghosticon.jpg"
    },
    "author": {
        "@type": "Person",
        "name": "Claudio Salazar",
        "image": {
            "@type": "ImageObject",
            "url": "//www.gravatar.com/avatar/134e22ab3b4cac1e783f88f84917bc12?s=250&d=mm&r=x",
            "width": 250,
            "height": 250
        },
        "url": "http://www.spect.cl/author/claudio/",
        "sameAs": []
    },
    "headline": "EKO12 Writeup",
    "url": "http://www.spect.cl/blog/2016/11/eko12-writeup/",
    "datePublished": "2016-11-02T19:13:35.000Z",
    "dateModified": "2016-11-02T19:14:00.000Z",
    "keywords": "ctf, security",
    "description": "La semana pasada asistí por primera vez a la ekoparty después de muchos años tratando de ir. Cerca de 2500 asistentes (más menos cinco veces la 8dot8 Chile), un programa de charlas técnicamente interesantes y un buen ambiente con un montón de desafíos por parte de compañías y organizaciones.  El",
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "http://www.spect.cl"
    }
}
    </script>

    <meta name="generator" content="Ghost 0.11">
    <link rel="alternate" type="application/rss+xml" title="SPECT Research" href="http://www.spect.cl/rss/">
    <script>
var disqus_shortname = 'spectresearch';
var ga_id = 'UA-18043187-1';
</script>
</head>

<body><header class="main-header no-cover">
    <div class="vertical">
        <div class="main-header-content inner">
            <h1 class="page-title">SPECT Research</h1>
            <h2 class="page-description">Security and Software Development</h2>
            <br>
            <div>
              <a class="spectnav" href="/"><i class="fa fa-home"></i> Home</a>
              <a class="spectnav" href="/about/"><i class="fa fa-group"></i> About us</a>
              <a class="spectnav" href="/projects/"><i class="fa fa-copy"></i> Projects</a>
              <a class="spectnav" href="/education/"><i class="fa fa-book"></i> Education</a>
            </div>
            <div>
              <a class="spectnav" href="http://github.com/spectresearch"><i class="spectnav fa fa-github"></i></a>
              <a class="spectnav" href="http://twitter.com/spectresearch"><i class="spectnav fa fa-twitter"></i></a>
            </div>
        </div>
    </div>
    <a class="scroll-down icon-arrow-left" href="#content" data-offset="-45"><span class="hidden">Scroll Down</span></a>
</header>



    

    <div class="site-wrapper">

        


<main class="content" role="main">
    <article class="post tag-ctf tag-security">

        <header class="post-header">
            <h1 class="post-title">EKO12 Writeup</h1>
            <section class="post-meta">
                <time class="post-date" datetime="2016-11-02">02 November 2016</time>  on <a href="/tag/ctf/">ctf</a>, <a href="/tag/security/">security</a>
            </section>
        </header>

        <section class="post-content">
            <p>La semana pasada asistí por primera vez a la <a href="http://ekoparty.org/">ekoparty</a> después de muchos años tratando de ir. Cerca de 2500 asistentes (más menos cinco veces la <a href="https://www.8dot8.org/">8dot8 Chile</a>), un programa de charlas técnicamente interesantes y un buen ambiente con un montón de desafíos por parte de compañías y organizaciones. </p>

<p>El que más me llamo la atención fue el <a href="http://ctf.ekoparty.org/">CTF oficial</a> de la conferencia organizado por <a href="https://null-life.com/">Null-Life</a>. Anteriormente no había tenido tiempo para participar en las versiones remotas así que me anime para la competencia local y logré el segundo lugar! </p>

<p><img src="http://cdn.spect.cl/blog/posts/images/eko12_final_score.png"></p>

<p>Fue una competencia dura ya que participé solo y la mayoría de los contrincantes eran teams de 3+ personas. Sumado a eso, no iba preparado: no tenía máquinas virtuales en mi laptop ni servidores con salida directa a Internet.</p>

<p>Sin embargo, logré resolver varias tareas:</p>

<p><img src="http://cdn.spect.cl/blog/posts/images/eko12_dashboard.png"></p>

<p>Hay un claro déficit en el área de reversing y exploiting ya que no es mi fuerte. Conforme a eso, hay una <a href="https://ctftime.org/event/342/tasks/">serie de writeups</a> ya en Internet así que me centraré en dos que me permitieron obtener el segundo lugar debido a su puntaje: <em>LSSO</em> (Misc 200) y <em>The Fake Satoshi</em> (Misc 300).</p>

<h3 id="lsso">LSSO</h3>

<blockquote>
  <p>All my passwords are safely stored, or not?</p>
</blockquote>

<p>Junto a esto, venía el siguiente adjunto: <a href="http://cdn.spect.cl/blog/posts/files/misc200.zip">misc200.zip</a>. Lo primero que me llamó la atención fue que viniera un fichero comprimido <code>.rar</code> dentro del <code>.zip</code>, lo cual no era común en las otras tareas.</p>

<p>Dentro del <code>.rar</code> venían dos ficheros: <code>cwallet.sso</code> y <code>ewallet.p12</code>. Buscando en Google por el primer fichero veo que corresponde a una <a href="https://docs.oracle.com/cd/E23943_01/core.1111/e10105/wallets.htm#CIHHAHHF">solución de Oracle</a> para guardar información de autologin. También en los primeros resultados sale una referencia a <a href="https://github.com/tejado/ssoDecrypt">ssoDecrypt</a>, la cual es una herramienta para descifrar estos ficheros. Después de instalarla una primera corrida arrojó lo siguiente:</p>

<pre><code class="language- language-bash">$ ./ssoDecrypt.sh ../cwallet.sso
PKCS12 key store mac invalid - wrong password or corrupted file.  
PKCS12 key store mac invalid - wrong password, wrong LSSO secret (username + hostname) or corrupted file.  
</code></pre>

<p>Leyendo más sobre la herramienta, al final de su <code>README</code> sale una referencia a <a href="https://github.com/tejado/ssoDecrypt#local-sso-wallet">Local SSO wallet</a>, por lo que relacionando con el título <em>LSSO</em>, la respuesta debía ir por ese lado. ¿ Dónde encontrar el usuario y hostname? Los ficheros comprimidos soportan comentarios así que lo primero en revisar sería el famoso <code>.rar</code>. </p>

<pre><code>$ unrar v ekochall.rar

UNRAR 5.30 beta 2 freeware      Copyright (c) 1993-2015 Alexander Roshal

By Hugo@ekodesktop  
[...]
</code></pre>

<p>Tenemos nuestro usuario y hostname, ahora a intentar obtener la respuesta.</p>

<pre><code>$ ./ssoDecrypt.sh ../cwallet.sso Hugo ekodesktop
sso key: a252ece7d911fa0e  
sso secret: 0e6b16ac78d6231bd237e71e0bb931c53765a6bf8f356acd  
obfuscated password: 444a4f701601137b7447745039566b03  
p12 password (hex): 2b416f615a571a645f442766103d2334  
--------------------------------------------------------
----------------------------------------------
Credential #1: ekoparty/EKO{vPgsSHXO0LiHlZk667Xr}@ekoparty  
</code></pre>

<p>La solución era <code>EKO{vPgsSHXO0LiHlZk667Xr}</code>.</p>

<h3 id="thefakesatoshi">The Fake Satoshi</h3>

<blockquote>
  <p>Hello Mr. Giarc, upload again your false PGP key to pgp.mit.edu and send us any file you want with its signature to prove you are the fake Satoshi!</p>
  
  <p>The key on the server should look like the following line (case sensitive):</p>
</blockquote>

<pre><code>Type bits/keyID     Date       User ID  
pub  1024R/5EB7CB21 2008-10-30 Fake Satoshi EKOPARTY12 (csalazar) &lt;satoshin@gmx.com&gt;  
</code></pre>

<p>Cuando leí este desafío, se me vino en mente un problema que hubo este año sobre las <em>short-key ids</em> en el desarrollo de un software open-source. Teniendo ya claro para donde iba el asunto, leí un completo <a href="https://gwolf.org/node/4070">post</a> sobre la problemática escrito por Gunnar Wolf. </p>

<p>Este post menciona el proyecto <a href="https://github.com/lachesis/scallion">scallion</a> que sirve para generar llaves GPG con ciertas características. Para este caso, hay dos requerimientos:</p>

<ul>
<li>Los últimos 8 bytes del fingerprint (<code>short-key-id</code>) debe ser <code>5EB7CB21</code>. </li>
<li>La fecha de generación de la llave debe ser <code>2008-10-30</code>.</li>
</ul>

<p>Afortunadamente <code>scallion</code> soporta expresiones regulares para definir los requerimientos de nuestra llave y el requerimiento de la fecha se puede solucionar fácilmente. Mi laptop no cuenta con una tarjeta GPU activa por lo que mi primo Francisco Chirino me ayudo en la generación de la llave apropiada:</p>

<p><code>scallion.exe --gpg 5EB7CB21$</code></p>

<p>El output de ese comando contiene una llave privada que tiene <code>short-key-id=5EB7CB21</code>.  Teniendo ya la llave GPG privada en <code>satoshi.key</code>, la importé en el anillo <em>GPG</em>:</p>

<p><code>$ gpg --import --allow-non-selfsigned-uid satoshi.key</code></p>

<p>Lo último que quedaba por editar era el nombre que aparecía en la llave, lo cual se puede hacer con la opción <code>--edit-key</code>:</p>

<p><code>$ gpg --edit-key 5EB7CB21</code></p>

<p>Ahí es necesario eliminar el nombre inicial y agregar <code>Fake Satoshi EKOPARTY12 (csalazar)</code> con el correspondiente e-mail <code>satoshin@gmx.com</code>. Finalmente, subí la llave a <code>pgp.mit.edu</code> con la opción <code>--send-keys</code>:</p>

<p><code>$ gpg --send-keys --keyserver pgp.mit.edu 5EB7CB21</code></p>

<p><img src="http://cdn.spect.cl/blog/posts/images/eko12_gpg_key.png"></p>

<p>Luego, el reto consistía en firmar un fichero cualquiera (en este caso <code>boom.txt</code>) con la llave:</p>

<p><code>$ gpg -u 5EB7CB21 --sign boom.txt</code></p>

<p>Se debía subir el fichero y la firma. Tras eso, el servidor bajaba todas las firmas con <code>short-key-id=5EB7CB21</code> para verificar si mi fichero fue firmado por una llave con ese <code>short-key-id</code>. Como lo anterior es verdadero, retornaba la solución en su output. </p>
        </section>

        <footer class="post-footer">


            <figure class="author-image">
                <a class="img" href="/author/claudio/" style="background-image: url(//www.gravatar.com/avatar/134e22ab3b4cac1e783f88f84917bc12?s=250&amp;d=mm&amp;r=x)"><span class="hidden">Claudio Salazar's Picture</span></a>
            </figure>

            <section class="author">
                <h4><a href="/author/claudio/">Claudio Salazar</a></h4>

                    <p>Read <a href="/author/claudio/">more posts</a> by this author.</p>
                <div class="author-meta">
                    
                    
                </div>
            </section>


            <section class="share">
                <h4>Share this post</h4>
                <a class="icon-twitter" href="https://twitter.com/share?text=EKO12%20Writeup&amp;url=http://www.spect.cl/blog/2016/11/eko12-writeup/" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
                    <span class="hidden">Twitter</span>
                </a>
                <a class="icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u=http://www.spect.cl/blog/2016/11/eko12-writeup/" onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
                    <span class="hidden">Facebook</span>
                </a>
                <a class="icon-google-plus" href="https://plus.google.com/share?url=http://www.spect.cl/blog/2016/11/eko12-writeup/" onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
                    <span class="hidden">Google+</span>
                </a>
            </section>

        <footer class="post comments">
  <div id="disqus_thread"></div>
  <script type="text/javascript">
  (function() {
  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  dsq.src = '//' + window.disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</footer>

        </footer>

    </article>
</main>

<aside class="read-next">
    <a class="read-next-story prev no-cover" href="/blog/2016/09/para-la-constitucion-una-conversacion-sobre-seguridad/">
        <section class="post">
            <h2>Para la constitución, una conversación (sobre seguridad)</h2>
            <p>El día de ayer fue lanzado un exploit para MySQL que permite escalar privilegios dada una serie de condiciones.…</p>
        </section>
    </a>
</aside>



        <footer class="site-footer clearfix">
            <section class="copyright"><a href="http://www.spect.cl">SPECT Research</a> © 2016</section>
        </footer>

    </div>

    <!-- You can safely delete this line if your theme does not require jQuery -->
<script type="text/javascript" src="https://code.jquery.com/jquery-1.11.3.min.js"></script>
    <script>
  if (window.ga_id) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', window.ga_id, 'auto');
    ga('require', 'linkid', 'linkid.js');
    ga('send', 'pageview');
  }
</script>

    <script type="text/javascript" src="/assets/js/prism.js?v=31ba63e1d1"></script>
    <script type="text/javascript" src="/assets/js/jquery.fitvids.js?v=31ba63e1d1"></script>
    <script type="text/javascript" src="/assets/js/index.js?v=31ba63e1d1"></script>


</body>